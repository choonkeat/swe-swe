<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, interactive-widget=resizes-content">
    <title>{{.AssistantName}} - {{.UUIDShort}} - swe-swe</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/xterm.css?v={{.Version}}">
    <link rel="stylesheet" href="/styles/terminal-ui.css?v={{.Version}}">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        html, body {
            height: 100%;
            background: #1e1e1e;
            overflow: hidden;
        }
        terminal-ui {
            display: block;
            height: 100%;
        }
    </style>
</head>
<body>
    <terminal-ui uuid="{{.UUID}}" assistant="{{.Assistant}}" links=""></terminal-ui>
    <script src="/xterm.js?v={{.Version}}"></script>
    <script src="/xterm-addon-fit.js?v={{.Version}}"></script>
    <script src="/link-provider.js?v={{.Version}}"></script>
    <script type="module">
        // Apply theme color from URL or localStorage
        import { applyTheme, getEffectivePrimaryColor, COLOR_STORAGE_KEYS, saveColorPreference } from '/color-utils.js?v={{.Version}}';

        const urlParams = new URLSearchParams(window.location.search);
        const urlColor = urlParams.get('color');
        const sessionId = '{{.UUID}}';

        const primaryColor = getEffectivePrimaryColor({
            sessionId: sessionId,
            urlParam: urlColor,
            fallback: '#7c3aed'
        });

        applyTheme(primaryColor);

        // If color came from URL, save it for this session
        if (urlColor) {
            saveColorPreference(COLOR_STORAGE_KEYS.SESSION_PREFIX + sessionId, primaryColor);
        }

        // Expose for settings panel
        window.sweSweTheme = {
            applyTheme,
            getEffectivePrimaryColor,
            COLOR_STORAGE_KEYS,
            saveColorPreference,
            sessionId,
            getCurrentColor: () => getEffectivePrimaryColor({ sessionId, fallback: '#7c3aed' })
        };
    </script>
    <script type="module" src="/terminal-ui.js?v={{.Version}}"></script>
</body>
</html>
