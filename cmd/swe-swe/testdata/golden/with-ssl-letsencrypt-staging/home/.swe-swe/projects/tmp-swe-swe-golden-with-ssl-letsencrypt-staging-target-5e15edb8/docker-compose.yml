services:
  traefik:
    image: traefik:v2.11
    command:
      - "--api=true"
      - "--api.dashboard=true"
      - "--providers.docker=true"
      - "--providers.docker.exposedbydefault=false"
      - "--providers.docker.network=${PROJECT_NAME}_swe-network"
      # Only discover containers with matching project label (enables multi-project isolation)
      - "--providers.docker.constraints=Label(`swe.project`,`${PROJECT_NAME}`)"
      - "--providers.file.filename=/etc/traefik/dynamic.yml"
      - "--log.level=DEBUG"
      - "--accesslog=true"
      - "--accesslog.format=json"
      # Port 80 for ACME HTTP-01 challenges and HTTPâ†’HTTPS redirect
      - "--entrypoints.web.address=:80"
      - "--entrypoints.web.http.redirections.entryPoint.to=websecure"
      - "--entrypoints.web.http.redirections.entryPoint.scheme=https"
      - "--entrypoints.websecure.address=:7443"
      - "--entrypoints.websecure.transport.respondingTimeouts.readTimeout=60s"
      # Preview proxy entrypoints (per-session)
      - "--entrypoints.preview3000.address=:53000"
      - "--entrypoints.preview3000.transport.respondingTimeouts.readTimeout=60s"
      - "--entrypoints.preview3001.address=:53001"
      - "--entrypoints.preview3001.transport.respondingTimeouts.readTimeout=60s"
      - "--entrypoints.preview3002.address=:53002"
      - "--entrypoints.preview3002.transport.respondingTimeouts.readTimeout=60s"
      - "--entrypoints.preview3003.address=:53003"
      - "--entrypoints.preview3003.transport.respondingTimeouts.readTimeout=60s"
      - "--entrypoints.preview3004.address=:53004"
      - "--entrypoints.preview3004.transport.respondingTimeouts.readTimeout=60s"
      - "--entrypoints.preview3005.address=:53005"
      - "--entrypoints.preview3005.transport.respondingTimeouts.readTimeout=60s"
      - "--entrypoints.preview3006.address=:53006"
      - "--entrypoints.preview3006.transport.respondingTimeouts.readTimeout=60s"
      - "--entrypoints.preview3007.address=:53007"
      - "--entrypoints.preview3007.transport.respondingTimeouts.readTimeout=60s"
      - "--entrypoints.preview3008.address=:53008"
      - "--entrypoints.preview3008.transport.respondingTimeouts.readTimeout=60s"
      - "--entrypoints.preview3009.address=:53009"
      - "--entrypoints.preview3009.transport.respondingTimeouts.readTimeout=60s"
      - "--entrypoints.preview3010.address=:53010"
      - "--entrypoints.preview3010.transport.respondingTimeouts.readTimeout=60s"
      - "--entrypoints.preview3011.address=:53011"
      - "--entrypoints.preview3011.transport.respondingTimeouts.readTimeout=60s"
      - "--entrypoints.preview3012.address=:53012"
      - "--entrypoints.preview3012.transport.respondingTimeouts.readTimeout=60s"
      - "--entrypoints.preview3013.address=:53013"
      - "--entrypoints.preview3013.transport.respondingTimeouts.readTimeout=60s"
      - "--entrypoints.preview3014.address=:53014"
      - "--entrypoints.preview3014.transport.respondingTimeouts.readTimeout=60s"
      - "--entrypoints.preview3015.address=:53015"
      - "--entrypoints.preview3015.transport.respondingTimeouts.readTimeout=60s"
      - "--entrypoints.preview3016.address=:53016"
      - "--entrypoints.preview3016.transport.respondingTimeouts.readTimeout=60s"
      - "--entrypoints.preview3017.address=:53017"
      - "--entrypoints.preview3017.transport.respondingTimeouts.readTimeout=60s"
      - "--entrypoints.preview3018.address=:53018"
      - "--entrypoints.preview3018.transport.respondingTimeouts.readTimeout=60s"
      - "--entrypoints.preview3019.address=:53019"
      - "--entrypoints.preview3019.transport.respondingTimeouts.readTimeout=60s"
      # Agent chat proxy entrypoints (per-session)
      - "--entrypoints.agentchat4000.address=:44000"
      - "--entrypoints.agentchat4000.transport.respondingTimeouts.readTimeout=60s"
      - "--entrypoints.agentchat4001.address=:44001"
      - "--entrypoints.agentchat4001.transport.respondingTimeouts.readTimeout=60s"
      - "--entrypoints.agentchat4002.address=:44002"
      - "--entrypoints.agentchat4002.transport.respondingTimeouts.readTimeout=60s"
      - "--entrypoints.agentchat4003.address=:44003"
      - "--entrypoints.agentchat4003.transport.respondingTimeouts.readTimeout=60s"
      - "--entrypoints.agentchat4004.address=:44004"
      - "--entrypoints.agentchat4004.transport.respondingTimeouts.readTimeout=60s"
      - "--entrypoints.agentchat4005.address=:44005"
      - "--entrypoints.agentchat4005.transport.respondingTimeouts.readTimeout=60s"
      - "--entrypoints.agentchat4006.address=:44006"
      - "--entrypoints.agentchat4006.transport.respondingTimeouts.readTimeout=60s"
      - "--entrypoints.agentchat4007.address=:44007"
      - "--entrypoints.agentchat4007.transport.respondingTimeouts.readTimeout=60s"
      - "--entrypoints.agentchat4008.address=:44008"
      - "--entrypoints.agentchat4008.transport.respondingTimeouts.readTimeout=60s"
      - "--entrypoints.agentchat4009.address=:44009"
      - "--entrypoints.agentchat4009.transport.respondingTimeouts.readTimeout=60s"
      - "--entrypoints.agentchat4010.address=:44010"
      - "--entrypoints.agentchat4010.transport.respondingTimeouts.readTimeout=60s"
      - "--entrypoints.agentchat4011.address=:44011"
      - "--entrypoints.agentchat4011.transport.respondingTimeouts.readTimeout=60s"
      - "--entrypoints.agentchat4012.address=:44012"
      - "--entrypoints.agentchat4012.transport.respondingTimeouts.readTimeout=60s"
      - "--entrypoints.agentchat4013.address=:44013"
      - "--entrypoints.agentchat4013.transport.respondingTimeouts.readTimeout=60s"
      - "--entrypoints.agentchat4014.address=:44014"
      - "--entrypoints.agentchat4014.transport.respondingTimeouts.readTimeout=60s"
      - "--entrypoints.agentchat4015.address=:44015"
      - "--entrypoints.agentchat4015.transport.respondingTimeouts.readTimeout=60s"
      - "--entrypoints.agentchat4016.address=:44016"
      - "--entrypoints.agentchat4016.transport.respondingTimeouts.readTimeout=60s"
      - "--entrypoints.agentchat4017.address=:44017"
      - "--entrypoints.agentchat4017.transport.respondingTimeouts.readTimeout=60s"
      - "--entrypoints.agentchat4018.address=:44018"
      - "--entrypoints.agentchat4018.transport.respondingTimeouts.readTimeout=60s"
      - "--entrypoints.agentchat4019.address=:44019"
      - "--entrypoints.agentchat4019.transport.respondingTimeouts.readTimeout=60s"
      # Let's Encrypt ACME configuration (staging - for internal testing)
      - "--certificatesresolvers.letsencrypt.acme.email=admin@example.com"
      - "--certificatesresolvers.letsencrypt.acme.storage=/etc/traefik/acme/acme.json"
      - "--certificatesresolvers.letsencrypt.acme.httpchallenge.entrypoint=web"
      - "--certificatesresolvers.letsencrypt.acme.caserver=https://acme-staging-v02.api.letsencrypt.org/directory"
    ports:
      # Port 80 for ACME challenges and HTTP redirect
      - "80:80"
      - "${SWE_PORT:-1977}:7443"
      # Preview proxy ports (per-session)
      - "53000:53000"
      - "53001:53001"
      - "53002:53002"
      - "53003:53003"
      - "53004:53004"
      - "53005:53005"
      - "53006:53006"
      - "53007:53007"
      - "53008:53008"
      - "53009:53009"
      - "53010:53010"
      - "53011:53011"
      - "53012:53012"
      - "53013:53013"
      - "53014:53014"
      - "53015:53015"
      - "53016:53016"
      - "53017:53017"
      - "53018:53018"
      - "53019:53019"
      # Agent chat proxy ports (per-session)
      - "44000:44000"
      - "44001:44001"
      - "44002:44002"
      - "44003:44003"
      - "44004:44004"
      - "44005:44005"
      - "44006:44006"
      - "44007:44007"
      - "44008:44008"
      - "44009:44009"
      - "44010:44010"
      - "44011:44011"
      - "44012:44012"
      - "44013:44013"
      - "44014:44014"
      - "44015:44015"
      - "44016:44016"
      - "44017:44017"
      - "44018:44018"
      - "44019:44019"
    volumes:
      - "/var/run/docker.sock:/var/run/docker.sock:ro"
      - "./traefik-dynamic.yml:/etc/traefik/dynamic.yml:ro"
      - "${HOME}/.swe-swe/acme:/etc/traefik/acme"
    labels:
      # Project label for multi-instance isolation
      - "swe.project=${PROJECT_NAME}"
    networks:
      - swe-network
    depends_on:
      - auth
      - swe-swe
    restart: unless-stopped

  auth:
    build:
      context: ./auth
    environment:
      - SWE_SWE_PASSWORD=${SWE_SWE_PASSWORD:-changeme}
    labels:
      - "swe.project=${PROJECT_NAME}"
      - "traefik.enable=true"
      - "traefik.http.routers.${PROJECT_NAME}-auth.rule=PathPrefix(`/swe-swe-auth`)"
      - "traefik.http.routers.${PROJECT_NAME}-auth.priority=200"
      - "traefik.http.routers.${PROJECT_NAME}-auth.entrypoints=websecure"
      - "traefik.http.routers.${PROJECT_NAME}-auth.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-auth.tls.domains[0].main=google.com"
      - "traefik.http.services.${PROJECT_NAME}-auth.loadbalancer.server.port=4180"
    networks:
      - swe-network
    restart: unless-stopped

  chrome:
    build:
      context: .
      dockerfile: chrome-screencast/Dockerfile
    extra_hosts:
      - "host.docker.internal:host-gateway"
    labels:
      - "swe.project=${PROJECT_NAME}"
      - "traefik.enable=true"
      - "traefik.http.routers.${PROJECT_NAME}-chrome.rule=Path(`/chrome`) || PathPrefix(`/chrome/`)"
      - "traefik.http.routers.${PROJECT_NAME}-chrome.priority=100"
      - "traefik.http.routers.${PROJECT_NAME}-chrome.entrypoints=websecure"
      - "traefik.http.routers.${PROJECT_NAME}-chrome.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-chrome.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-chrome.middlewares=forwardauth@file,${PROJECT_NAME}-chrome-redirect@docker,${PROJECT_NAME}-chrome-strip@docker"
      - "traefik.http.services.${PROJECT_NAME}-chrome.loadbalancer.server.port=6080"
      - "traefik.http.middlewares.${PROJECT_NAME}-chrome-redirect.redirectregex.regex=^/chrome$$"
      - "traefik.http.middlewares.${PROJECT_NAME}-chrome-redirect.redirectregex.replacement=/chrome/"
      - "traefik.http.middlewares.${PROJECT_NAME}-chrome-strip.stripprefix.prefixes=/chrome"
    volumes:
      # Enterprise certificates (if certs/ directory exists with certificates)
      - ./certs:/swe-swe/certs:ro
    networks:
      - swe-network
    restart: unless-stopped

  swe-swe:
    build:
      context: .
      dockerfile: Dockerfile
    extra_hosts:
      - "host.docker.internal:host-gateway"
    labels:
      - "swe.project=${PROJECT_NAME}"
      - "traefik.enable=true"
      - "traefik.http.routers.${PROJECT_NAME}-swe-swe.rule=PathPrefix(`/`)"
      - "traefik.http.routers.${PROJECT_NAME}-swe-swe.priority=10"
      - "traefik.http.routers.${PROJECT_NAME}-swe-swe.entrypoints=websecure"
      - "traefik.http.routers.${PROJECT_NAME}-swe-swe.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-swe-swe.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-swe-swe.middlewares=forwardauth@file"
      - "traefik.http.routers.${PROJECT_NAME}-swe-swe.service=${PROJECT_NAME}-swe-swe"
      - "traefik.http.services.${PROJECT_NAME}-swe-swe.loadbalancer.server.port=9898"
      # Preview proxy routing (per-session)
      - "traefik.http.routers.${PROJECT_NAME}-preview-3000.rule=PathPrefix(`/`)"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3000.entrypoints=preview3000"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3000.middlewares=forwardauth@file"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3000.service=${PROJECT_NAME}-preview-3000"
      - "traefik.http.services.${PROJECT_NAME}-preview-3000.loadbalancer.server.port=53000"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3000-preflight.rule=PathPrefix(`/__swe-swe-debug__/target`) && Method(`OPTIONS`)"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3000-preflight.entrypoints=preview3000"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3000-preflight.priority=200"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3000-preflight.service=${PROJECT_NAME}-preview-3000"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3000.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3000.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3000-preflight.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3000-preflight.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3001.rule=PathPrefix(`/`)"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3001.entrypoints=preview3001"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3001.middlewares=forwardauth@file"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3001.service=${PROJECT_NAME}-preview-3001"
      - "traefik.http.services.${PROJECT_NAME}-preview-3001.loadbalancer.server.port=53001"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3001-preflight.rule=PathPrefix(`/__swe-swe-debug__/target`) && Method(`OPTIONS`)"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3001-preflight.entrypoints=preview3001"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3001-preflight.priority=200"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3001-preflight.service=${PROJECT_NAME}-preview-3001"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3001.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3001.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3001-preflight.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3001-preflight.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3002.rule=PathPrefix(`/`)"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3002.entrypoints=preview3002"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3002.middlewares=forwardauth@file"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3002.service=${PROJECT_NAME}-preview-3002"
      - "traefik.http.services.${PROJECT_NAME}-preview-3002.loadbalancer.server.port=53002"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3002-preflight.rule=PathPrefix(`/__swe-swe-debug__/target`) && Method(`OPTIONS`)"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3002-preflight.entrypoints=preview3002"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3002-preflight.priority=200"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3002-preflight.service=${PROJECT_NAME}-preview-3002"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3002.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3002.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3002-preflight.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3002-preflight.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3003.rule=PathPrefix(`/`)"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3003.entrypoints=preview3003"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3003.middlewares=forwardauth@file"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3003.service=${PROJECT_NAME}-preview-3003"
      - "traefik.http.services.${PROJECT_NAME}-preview-3003.loadbalancer.server.port=53003"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3003-preflight.rule=PathPrefix(`/__swe-swe-debug__/target`) && Method(`OPTIONS`)"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3003-preflight.entrypoints=preview3003"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3003-preflight.priority=200"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3003-preflight.service=${PROJECT_NAME}-preview-3003"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3003.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3003.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3003-preflight.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3003-preflight.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3004.rule=PathPrefix(`/`)"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3004.entrypoints=preview3004"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3004.middlewares=forwardauth@file"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3004.service=${PROJECT_NAME}-preview-3004"
      - "traefik.http.services.${PROJECT_NAME}-preview-3004.loadbalancer.server.port=53004"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3004-preflight.rule=PathPrefix(`/__swe-swe-debug__/target`) && Method(`OPTIONS`)"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3004-preflight.entrypoints=preview3004"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3004-preflight.priority=200"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3004-preflight.service=${PROJECT_NAME}-preview-3004"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3004.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3004.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3004-preflight.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3004-preflight.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3005.rule=PathPrefix(`/`)"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3005.entrypoints=preview3005"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3005.middlewares=forwardauth@file"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3005.service=${PROJECT_NAME}-preview-3005"
      - "traefik.http.services.${PROJECT_NAME}-preview-3005.loadbalancer.server.port=53005"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3005-preflight.rule=PathPrefix(`/__swe-swe-debug__/target`) && Method(`OPTIONS`)"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3005-preflight.entrypoints=preview3005"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3005-preflight.priority=200"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3005-preflight.service=${PROJECT_NAME}-preview-3005"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3005.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3005.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3005-preflight.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3005-preflight.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3006.rule=PathPrefix(`/`)"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3006.entrypoints=preview3006"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3006.middlewares=forwardauth@file"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3006.service=${PROJECT_NAME}-preview-3006"
      - "traefik.http.services.${PROJECT_NAME}-preview-3006.loadbalancer.server.port=53006"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3006-preflight.rule=PathPrefix(`/__swe-swe-debug__/target`) && Method(`OPTIONS`)"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3006-preflight.entrypoints=preview3006"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3006-preflight.priority=200"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3006-preflight.service=${PROJECT_NAME}-preview-3006"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3006.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3006.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3006-preflight.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3006-preflight.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3007.rule=PathPrefix(`/`)"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3007.entrypoints=preview3007"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3007.middlewares=forwardauth@file"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3007.service=${PROJECT_NAME}-preview-3007"
      - "traefik.http.services.${PROJECT_NAME}-preview-3007.loadbalancer.server.port=53007"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3007-preflight.rule=PathPrefix(`/__swe-swe-debug__/target`) && Method(`OPTIONS`)"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3007-preflight.entrypoints=preview3007"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3007-preflight.priority=200"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3007-preflight.service=${PROJECT_NAME}-preview-3007"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3007.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3007.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3007-preflight.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3007-preflight.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3008.rule=PathPrefix(`/`)"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3008.entrypoints=preview3008"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3008.middlewares=forwardauth@file"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3008.service=${PROJECT_NAME}-preview-3008"
      - "traefik.http.services.${PROJECT_NAME}-preview-3008.loadbalancer.server.port=53008"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3008-preflight.rule=PathPrefix(`/__swe-swe-debug__/target`) && Method(`OPTIONS`)"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3008-preflight.entrypoints=preview3008"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3008-preflight.priority=200"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3008-preflight.service=${PROJECT_NAME}-preview-3008"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3008.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3008.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3008-preflight.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3008-preflight.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3009.rule=PathPrefix(`/`)"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3009.entrypoints=preview3009"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3009.middlewares=forwardauth@file"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3009.service=${PROJECT_NAME}-preview-3009"
      - "traefik.http.services.${PROJECT_NAME}-preview-3009.loadbalancer.server.port=53009"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3009-preflight.rule=PathPrefix(`/__swe-swe-debug__/target`) && Method(`OPTIONS`)"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3009-preflight.entrypoints=preview3009"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3009-preflight.priority=200"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3009-preflight.service=${PROJECT_NAME}-preview-3009"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3009.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3009.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3009-preflight.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3009-preflight.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3010.rule=PathPrefix(`/`)"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3010.entrypoints=preview3010"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3010.middlewares=forwardauth@file"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3010.service=${PROJECT_NAME}-preview-3010"
      - "traefik.http.services.${PROJECT_NAME}-preview-3010.loadbalancer.server.port=53010"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3010-preflight.rule=PathPrefix(`/__swe-swe-debug__/target`) && Method(`OPTIONS`)"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3010-preflight.entrypoints=preview3010"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3010-preflight.priority=200"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3010-preflight.service=${PROJECT_NAME}-preview-3010"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3010.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3010.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3010-preflight.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3010-preflight.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3011.rule=PathPrefix(`/`)"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3011.entrypoints=preview3011"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3011.middlewares=forwardauth@file"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3011.service=${PROJECT_NAME}-preview-3011"
      - "traefik.http.services.${PROJECT_NAME}-preview-3011.loadbalancer.server.port=53011"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3011-preflight.rule=PathPrefix(`/__swe-swe-debug__/target`) && Method(`OPTIONS`)"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3011-preflight.entrypoints=preview3011"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3011-preflight.priority=200"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3011-preflight.service=${PROJECT_NAME}-preview-3011"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3011.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3011.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3011-preflight.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3011-preflight.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3012.rule=PathPrefix(`/`)"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3012.entrypoints=preview3012"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3012.middlewares=forwardauth@file"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3012.service=${PROJECT_NAME}-preview-3012"
      - "traefik.http.services.${PROJECT_NAME}-preview-3012.loadbalancer.server.port=53012"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3012-preflight.rule=PathPrefix(`/__swe-swe-debug__/target`) && Method(`OPTIONS`)"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3012-preflight.entrypoints=preview3012"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3012-preflight.priority=200"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3012-preflight.service=${PROJECT_NAME}-preview-3012"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3012.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3012.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3012-preflight.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3012-preflight.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3013.rule=PathPrefix(`/`)"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3013.entrypoints=preview3013"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3013.middlewares=forwardauth@file"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3013.service=${PROJECT_NAME}-preview-3013"
      - "traefik.http.services.${PROJECT_NAME}-preview-3013.loadbalancer.server.port=53013"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3013-preflight.rule=PathPrefix(`/__swe-swe-debug__/target`) && Method(`OPTIONS`)"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3013-preflight.entrypoints=preview3013"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3013-preflight.priority=200"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3013-preflight.service=${PROJECT_NAME}-preview-3013"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3013.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3013.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3013-preflight.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3013-preflight.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3014.rule=PathPrefix(`/`)"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3014.entrypoints=preview3014"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3014.middlewares=forwardauth@file"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3014.service=${PROJECT_NAME}-preview-3014"
      - "traefik.http.services.${PROJECT_NAME}-preview-3014.loadbalancer.server.port=53014"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3014-preflight.rule=PathPrefix(`/__swe-swe-debug__/target`) && Method(`OPTIONS`)"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3014-preflight.entrypoints=preview3014"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3014-preflight.priority=200"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3014-preflight.service=${PROJECT_NAME}-preview-3014"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3014.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3014.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3014-preflight.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3014-preflight.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3015.rule=PathPrefix(`/`)"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3015.entrypoints=preview3015"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3015.middlewares=forwardauth@file"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3015.service=${PROJECT_NAME}-preview-3015"
      - "traefik.http.services.${PROJECT_NAME}-preview-3015.loadbalancer.server.port=53015"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3015-preflight.rule=PathPrefix(`/__swe-swe-debug__/target`) && Method(`OPTIONS`)"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3015-preflight.entrypoints=preview3015"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3015-preflight.priority=200"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3015-preflight.service=${PROJECT_NAME}-preview-3015"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3015.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3015.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3015-preflight.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3015-preflight.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3016.rule=PathPrefix(`/`)"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3016.entrypoints=preview3016"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3016.middlewares=forwardauth@file"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3016.service=${PROJECT_NAME}-preview-3016"
      - "traefik.http.services.${PROJECT_NAME}-preview-3016.loadbalancer.server.port=53016"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3016-preflight.rule=PathPrefix(`/__swe-swe-debug__/target`) && Method(`OPTIONS`)"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3016-preflight.entrypoints=preview3016"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3016-preflight.priority=200"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3016-preflight.service=${PROJECT_NAME}-preview-3016"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3016.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3016.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3016-preflight.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3016-preflight.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3017.rule=PathPrefix(`/`)"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3017.entrypoints=preview3017"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3017.middlewares=forwardauth@file"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3017.service=${PROJECT_NAME}-preview-3017"
      - "traefik.http.services.${PROJECT_NAME}-preview-3017.loadbalancer.server.port=53017"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3017-preflight.rule=PathPrefix(`/__swe-swe-debug__/target`) && Method(`OPTIONS`)"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3017-preflight.entrypoints=preview3017"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3017-preflight.priority=200"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3017-preflight.service=${PROJECT_NAME}-preview-3017"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3017.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3017.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3017-preflight.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3017-preflight.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3018.rule=PathPrefix(`/`)"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3018.entrypoints=preview3018"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3018.middlewares=forwardauth@file"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3018.service=${PROJECT_NAME}-preview-3018"
      - "traefik.http.services.${PROJECT_NAME}-preview-3018.loadbalancer.server.port=53018"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3018-preflight.rule=PathPrefix(`/__swe-swe-debug__/target`) && Method(`OPTIONS`)"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3018-preflight.entrypoints=preview3018"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3018-preflight.priority=200"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3018-preflight.service=${PROJECT_NAME}-preview-3018"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3018.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3018.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3018-preflight.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3018-preflight.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3019.rule=PathPrefix(`/`)"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3019.entrypoints=preview3019"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3019.middlewares=forwardauth@file"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3019.service=${PROJECT_NAME}-preview-3019"
      - "traefik.http.services.${PROJECT_NAME}-preview-3019.loadbalancer.server.port=53019"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3019-preflight.rule=PathPrefix(`/__swe-swe-debug__/target`) && Method(`OPTIONS`)"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3019-preflight.entrypoints=preview3019"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3019-preflight.priority=200"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3019-preflight.service=${PROJECT_NAME}-preview-3019"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3019.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3019.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3019-preflight.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-preview-3019-preflight.tls.domains[0].main=google.com"
      # Agent chat proxy routing (per-session)
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4000.rule=PathPrefix(`/`)"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4000.entrypoints=agentchat4000"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4000.middlewares=forwardauth@file"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4000.service=${PROJECT_NAME}-agentchat-4000"
      - "traefik.http.services.${PROJECT_NAME}-agentchat-4000.loadbalancer.server.port=44000"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4000.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4000.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4001.rule=PathPrefix(`/`)"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4001.entrypoints=agentchat4001"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4001.middlewares=forwardauth@file"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4001.service=${PROJECT_NAME}-agentchat-4001"
      - "traefik.http.services.${PROJECT_NAME}-agentchat-4001.loadbalancer.server.port=44001"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4001.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4001.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4002.rule=PathPrefix(`/`)"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4002.entrypoints=agentchat4002"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4002.middlewares=forwardauth@file"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4002.service=${PROJECT_NAME}-agentchat-4002"
      - "traefik.http.services.${PROJECT_NAME}-agentchat-4002.loadbalancer.server.port=44002"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4002.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4002.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4003.rule=PathPrefix(`/`)"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4003.entrypoints=agentchat4003"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4003.middlewares=forwardauth@file"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4003.service=${PROJECT_NAME}-agentchat-4003"
      - "traefik.http.services.${PROJECT_NAME}-agentchat-4003.loadbalancer.server.port=44003"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4003.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4003.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4004.rule=PathPrefix(`/`)"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4004.entrypoints=agentchat4004"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4004.middlewares=forwardauth@file"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4004.service=${PROJECT_NAME}-agentchat-4004"
      - "traefik.http.services.${PROJECT_NAME}-agentchat-4004.loadbalancer.server.port=44004"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4004.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4004.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4005.rule=PathPrefix(`/`)"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4005.entrypoints=agentchat4005"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4005.middlewares=forwardauth@file"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4005.service=${PROJECT_NAME}-agentchat-4005"
      - "traefik.http.services.${PROJECT_NAME}-agentchat-4005.loadbalancer.server.port=44005"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4005.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4005.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4006.rule=PathPrefix(`/`)"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4006.entrypoints=agentchat4006"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4006.middlewares=forwardauth@file"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4006.service=${PROJECT_NAME}-agentchat-4006"
      - "traefik.http.services.${PROJECT_NAME}-agentchat-4006.loadbalancer.server.port=44006"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4006.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4006.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4007.rule=PathPrefix(`/`)"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4007.entrypoints=agentchat4007"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4007.middlewares=forwardauth@file"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4007.service=${PROJECT_NAME}-agentchat-4007"
      - "traefik.http.services.${PROJECT_NAME}-agentchat-4007.loadbalancer.server.port=44007"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4007.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4007.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4008.rule=PathPrefix(`/`)"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4008.entrypoints=agentchat4008"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4008.middlewares=forwardauth@file"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4008.service=${PROJECT_NAME}-agentchat-4008"
      - "traefik.http.services.${PROJECT_NAME}-agentchat-4008.loadbalancer.server.port=44008"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4008.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4008.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4009.rule=PathPrefix(`/`)"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4009.entrypoints=agentchat4009"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4009.middlewares=forwardauth@file"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4009.service=${PROJECT_NAME}-agentchat-4009"
      - "traefik.http.services.${PROJECT_NAME}-agentchat-4009.loadbalancer.server.port=44009"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4009.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4009.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4010.rule=PathPrefix(`/`)"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4010.entrypoints=agentchat4010"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4010.middlewares=forwardauth@file"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4010.service=${PROJECT_NAME}-agentchat-4010"
      - "traefik.http.services.${PROJECT_NAME}-agentchat-4010.loadbalancer.server.port=44010"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4010.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4010.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4011.rule=PathPrefix(`/`)"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4011.entrypoints=agentchat4011"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4011.middlewares=forwardauth@file"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4011.service=${PROJECT_NAME}-agentchat-4011"
      - "traefik.http.services.${PROJECT_NAME}-agentchat-4011.loadbalancer.server.port=44011"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4011.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4011.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4012.rule=PathPrefix(`/`)"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4012.entrypoints=agentchat4012"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4012.middlewares=forwardauth@file"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4012.service=${PROJECT_NAME}-agentchat-4012"
      - "traefik.http.services.${PROJECT_NAME}-agentchat-4012.loadbalancer.server.port=44012"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4012.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4012.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4013.rule=PathPrefix(`/`)"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4013.entrypoints=agentchat4013"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4013.middlewares=forwardauth@file"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4013.service=${PROJECT_NAME}-agentchat-4013"
      - "traefik.http.services.${PROJECT_NAME}-agentchat-4013.loadbalancer.server.port=44013"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4013.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4013.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4014.rule=PathPrefix(`/`)"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4014.entrypoints=agentchat4014"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4014.middlewares=forwardauth@file"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4014.service=${PROJECT_NAME}-agentchat-4014"
      - "traefik.http.services.${PROJECT_NAME}-agentchat-4014.loadbalancer.server.port=44014"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4014.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4014.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4015.rule=PathPrefix(`/`)"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4015.entrypoints=agentchat4015"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4015.middlewares=forwardauth@file"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4015.service=${PROJECT_NAME}-agentchat-4015"
      - "traefik.http.services.${PROJECT_NAME}-agentchat-4015.loadbalancer.server.port=44015"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4015.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4015.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4016.rule=PathPrefix(`/`)"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4016.entrypoints=agentchat4016"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4016.middlewares=forwardauth@file"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4016.service=${PROJECT_NAME}-agentchat-4016"
      - "traefik.http.services.${PROJECT_NAME}-agentchat-4016.loadbalancer.server.port=44016"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4016.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4016.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4017.rule=PathPrefix(`/`)"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4017.entrypoints=agentchat4017"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4017.middlewares=forwardauth@file"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4017.service=${PROJECT_NAME}-agentchat-4017"
      - "traefik.http.services.${PROJECT_NAME}-agentchat-4017.loadbalancer.server.port=44017"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4017.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4017.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4018.rule=PathPrefix(`/`)"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4018.entrypoints=agentchat4018"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4018.middlewares=forwardauth@file"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4018.service=${PROJECT_NAME}-agentchat-4018"
      - "traefik.http.services.${PROJECT_NAME}-agentchat-4018.loadbalancer.server.port=44018"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4018.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4018.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4019.rule=PathPrefix(`/`)"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4019.entrypoints=agentchat4019"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4019.middlewares=forwardauth@file"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4019.service=${PROJECT_NAME}-agentchat-4019"
      - "traefik.http.services.${PROJECT_NAME}-agentchat-4019.loadbalancer.server.port=44019"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4019.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-agentchat-4019.tls.domains[0].main=google.com"
    depends_on:
      - chrome
    volumes:
      # Mount project directory to /workspace
      - ${WORKSPACE_DIR:-.}:/workspace
      # Mount worktrees to /worktrees for cleaner agent path separation
      - ${WORKSPACE_DIR:-.}/.swe-swe/worktrees:/worktrees
      # Mount external repos directory for persistence across container rebuilds
      - ${WORKSPACE_DIR:-.}/.swe-swe/repos:/repos
      # Mount persistent home for auth/config storage
      - ./home:/home/app
      # Enterprise certificates (if certs/ directory exists with certificates)
      - ./certs:/swe-swe/certs:ro
      # Tmpfs for file uploads - ensures writable regardless of bind mount permissions
      - type: tmpfs
        target: /workspace/.swe-swe/uploads
        tmpfs:
          size: 100M
          mode: 0777
    working_dir: /workspace
    networks:
      - swe-network
    environment:
      # Pass through API keys (edit or set as environment variables)
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      # Enterprise certificates (if configured during swe-swe init)
      - NODE_EXTRA_CA_CERTS=${NODE_EXTRA_CA_CERTS:-}
      - SSL_CERT_FILE=${SSL_CERT_FILE:-}
      # Browser automation via MCP Playwright connected to chrome service
      - BROWSER_WS_ENDPOINT=ws://chrome:9223
      # App preview proxy target port (for split-pane iframe)
      - SWE_PREVIEW_TARGET_PORT=${SWE_PREVIEW_TARGET_PORT:-3000}
      # App preview session port range (must match traefik entrypoints)
      - SWE_PREVIEW_PORTS=${SWE_PREVIEW_PORTS:-3000-3019}
      # Agent chat session port range (derived from preview ports + 1000)
      - SWE_AGENT_CHAT_PORTS=${SWE_AGENT_CHAT_PORTS:-4000-4019}
      # Add other credentials as needed:
      # - GEMINI_API_KEY=${GEMINI_API_KEY}
      # - OPENAI_API_KEY=${OPENAI_API_KEY}
    restart: unless-stopped

  vscode-proxy:
    image: nginx:latest
    volumes:
      - ./nginx-vscode.conf:/etc/nginx/conf.d/default.conf:ro
    labels:
      - "swe.project=${PROJECT_NAME}"
      - "traefik.enable=true"
      - "traefik.http.routers.${PROJECT_NAME}-vscode.rule=PathPrefix(`/vscode`)"
      - "traefik.http.routers.${PROJECT_NAME}-vscode.priority=100"
      - "traefik.http.routers.${PROJECT_NAME}-vscode.entrypoints=websecure"
      - "traefik.http.routers.${PROJECT_NAME}-vscode.tls.certresolver=letsencrypt"
      - "traefik.http.routers.${PROJECT_NAME}-vscode.tls.domains[0].main=google.com"
      - "traefik.http.routers.${PROJECT_NAME}-vscode.middlewares=forwardauth@file"
      - "traefik.http.services.${PROJECT_NAME}-vscode.loadbalancer.server.port=8081"
    depends_on:
      - code-server
    networks:
      - swe-network
    restart: unless-stopped

  code-server:
    build:
      context: code-server
      args:
        UID: 1000
        GID: 1000
    command:
      - "--bind-addr=0.0.0.0:8080"
      - "--auth=none"
    labels:
      - "swe.project=${PROJECT_NAME}"
    volumes:
      # Mount project directory (same path as swe-swe container for git worktree compatibility)
      - ${WORKSPACE_DIR:-.}:/workspace
      # Mount worktrees to /worktrees for cleaner agent path separation
      - ${WORKSPACE_DIR:-.}/.swe-swe/worktrees:/worktrees
      # Mount persistent home for VSCode settings/extensions
      - ./home:/home/coder
      # Enterprise certificates (if certs/ directory exists with certificates)
      - ./certs:/swe-swe/certs:ro
    working_dir: /workspace
    networks:
      - swe-network
    environment:
      - TZ=${TZ:-UTC}
      # Enterprise certificates (if configured during swe-swe init)
      - NODE_EXTRA_CA_CERTS=${NODE_EXTRA_CA_CERTS:-}
      - SSL_CERT_FILE=${SSL_CERT_FILE:-}
    restart: unless-stopped
networks:
  swe-network:
    driver: bridge
