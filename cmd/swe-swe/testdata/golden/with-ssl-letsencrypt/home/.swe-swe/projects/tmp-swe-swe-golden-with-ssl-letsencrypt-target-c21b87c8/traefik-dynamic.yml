# Traefik dynamic configuration for swe-swe

http:
  middlewares:
    # ForwardAuth middleware for session-based authentication
    forwardauth:
      forwardAuth:
        address: "http://auth:4180/swe-swe-auth/verify"
        # Trust X-Forwarded-* headers for proper URL handling
        trustForwardHeader: true

    # Rate limiting for login endpoint to prevent brute force
    login-ratelimit:
      rateLimit:
        average: 5
        burst: 10
        period: 1m

  routers:
    # Traefik dashboard protected by ForwardAuth
    # Note: Only match traefik's internal API paths, not /api/recording/* which goes to swe-swe
    dashboard:
      rule: "PathPrefix(`/api/http`) || PathPrefix(`/api/tcp`) || PathPrefix(`/api/entrypoints`) || PathPrefix(`/api/overview`) || PathPrefix(`/dashboard`)"
      service: "api@internal"
      middlewares:
        - "forwardauth"
      priority: 150
      entryPoints:
        - "websecure"
      tls:
        certResolver: letsencrypt
        domains:
          - main: "google.com"

