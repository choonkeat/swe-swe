[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid
loglevel=info

[program:chrome]
command=/ms-playwright/chromium-1140/chrome-linux/chrome --no-sandbox --disable-gpu --disable-software-rasterizer --disable-dev-shm-usage --remote-debugging-address=0.0.0.0 --remote-debugging-port=9222 --remote-allow-origins=* --headless=new
autorestart=true
priority=100
user=pwuser
environment=HOME="/home/pwuser"
stdout_logfile=/var/log/supervisor/chrome.log
stderr_logfile=/var/log/supervisor/chrome.err

[program:cdp-proxy]
command=/usr/sbin/nginx -g "daemon off;"
autorestart=true
priority=200
stdout_logfile=/var/log/supervisor/cdp-proxy.log
stderr_logfile=/var/log/supervisor/cdp-proxy.err
# Wait for Chrome to start
startsecs=3

[program:screencast]
command=/usr/bin/node /app/server.js
directory=/app
autorestart=true
priority=300
environment=PORT="6080",CHROME_CDP_URL="http://127.0.0.1:9222"
stdout_logfile=/var/log/supervisor/screencast.log
stderr_logfile=/var/log/supervisor/screencast.err
# Wait for Chrome to be available
startsecs=5
