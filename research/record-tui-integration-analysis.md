# record-tui Integration Analysis for swe-swe

## Executive Summary

This document analyzes the feasibility of using record-tui's HTML generation to replace swe-swe's current recording playback page.

**TL;DR**: The integration is **feasible but requires modifications** to record-tui to support:
1. Linux `script` format (different header format)
2. Timing-based animated playback (record-tui currently only does static display)
3. swe-swe's additional features (file/URL links, playback controls)

## Format Comparison: macOS vs Linux `script`

### Session Log Header

**macOS** (record-tui expects):
```
Script started on Wed Dec 31 15:01:40 2025
Command: claude
[terminal content...]
```

**Linux** (swe-swe produces):
```
Script started on 2026-01-12 06:41:43+00:00 [COMMAND="claude" TERM="xterm-256color" TTY="/dev/pts/4" COLUMNS="132" LINES="49"]
[terminal content...]
```

**Key Differences**:
| Aspect | macOS | Linux |
|--------|-------|-------|
| Date format | `Wed Dec 31 15:01:40 2025` | `2026-01-12 06:41:43+00:00` |
| Command info | Separate `Command:` line | Inline `[COMMAND="..."]` bracket |
| Terminal metadata | Not included | `TERM`, `TTY`, `COLUMNS`, `LINES` |
| Footer | `Script done on` | Same pattern |

### Timing Files

**macOS**: record-tui does **NOT** use timing files. Per ADR-002, it shows static final state only.

**Linux** (swe-swe): Uses `--log-timing=<file>` flag with format:
```
<delay_seconds> <byte_count>
3.549474 6
0.001491 4
```
Each line means: "wait X seconds, then output Y bytes from the log file."

## Code Architecture Comparison

### record-tui HTML Generation

Location: `/workspace/dist/choonkeat/record-tui/internal/html/template.go`

```go
func RenderPlaybackHTML(frames []PlaybackFrame) (string, error)
```

Features:
- Static display only (single frame with all content)
- xterm.js v5.3.0 for rendering
- Base64-encoded frame data
- Auto-dimension calculation
- Post-render row trimming
- Simple footer with "generated by record-tui" link

### swe-swe HTML Generation

Location: `/workspace/cmd/swe-swe/templates/host/swe-swe-server/playback/render.go`

```go
func RenderPlaybackHTML(frames []PlaybackFrame, name, backURL string, cols, rows uint16, workDir string) (string, error)
func RenderStaticHTML(content []byte, name, backURL string) string
```

Features:
- **Animated playback** with timing data
- Play/pause controls, progress bar, speed selector (0.5x-8x)
- Keyboard shortcuts (Space, arrows)
- Loading spinner with data size display
- **Clickable file paths** (opens VS Code with folder)
- **Clickable URLs** (http/https links)
- Navigation header with back link
- xterm-addon-fit for responsive sizing
- Fallback to static display when no timing data

## Feature Gap Analysis

| Feature | record-tui | swe-swe | Integration Approach |
|---------|------------|---------|---------------------|
| Static display | ✅ | ✅ | Use record-tui's cleaner approach |
| Animated playback | ❌ | ✅ | Keep swe-swe's implementation |
| Timing file parsing | ❌ | ✅ | Keep swe-swe's `ParseTimingFile()` |
| macOS header parsing | ✅ | ❌ | Extend to support both |
| Linux header parsing | ❌ | ✅ | Already implemented |
| File link provider | ❌ | ✅ | Keep swe-swe's implementation |
| URL link provider | ❌ | ✅ | Keep swe-swe's implementation |
| Playback controls | ❌ | ✅ | Keep swe-swe's implementation |
| xterm.js version | 5.3.0 | 5.3.0 | Same |
| Base64 encoding | ✅ | ✅ | Same approach |

## Go Package Import Verification

Testing import by git commit SHA:
```bash
go get github.com/choonkeat/record-tui@78fe0ba
```

**Issue**: record-tui's go.mod specifies `go 1.25.3` which doesn't exist (likely a typo). This needs to be fixed to something like `go 1.22` or `go 1.23` before it can be imported as a library.

After fixing the Go version, importing by commit SHA works:
```
go: downloading github.com/choonkeat/record-tui v0.0.0-20251231084111-78fe0bae7b01
```

## Integration Options

### Option 1: Import record-tui as Library

**Pros**:
- Cleaner separation of concerns
- Can update independently via git commit SHA
- record-tui gets improvements from swe-swe needs

**Cons**:
- Requires modifying record-tui's go.mod (fix Go version)
- Requires adding Linux format support to record-tui
- Would need to add animated playback to record-tui (against ADR-002)
- record-tui doesn't expose needed internal packages

**Work Required**:
1. Fix `go 1.25.3` → valid version in record-tui/go.mod
2. Modify `session.StripMetadata()` to handle Linux header format
3. Export internal packages or restructure for library use
4. Add optional timing-based playback mode

### Option 2: Vendored/Adapted Code

**Pros**:
- Full control over modifications
- No external dependency management
- Can keep swe-swe-specific features

**Cons**:
- Code duplication
- Must manually sync improvements

**Work Required**:
1. Copy and adapt `html/template.go`'s rendering approach
2. Keep swe-swe's timing parser and link providers
3. Unify visual style (currently very similar anyway)

### Option 3: record-tui as Recording Tool Only

Use record-tui for the **recording** (on macOS) and keep swe-swe's HTML generation.

**Pros**:
- No changes to HTML generation
- record-tui works as intended for macOS users

**Cons**:
- Doesn't solve the original goal
- Different recording formats would still need handling

## Recommended Approach

**Option 1 (with modifications to record-tui)** is the cleanest path if you want to share the HTML generation:

1. **Fix record-tui's go.mod** - change `go 1.25.3` to `go 1.22`

2. **Add Linux format support** to `session.StripMetadata()`:
   ```go
   // Already handles: "Script started on Wed Dec 31..."
   // Add handling for: "Script started on 2026-01-12... [COMMAND=...]"
   ```

3. **Create a library-friendly API** in record-tui:
   ```go
   // New package: github.com/choonkeat/record-tui/htmlgen

   type Options struct {
       Frames      []PlaybackFrame
       Title       string
       BackURL     string
       Animated    bool     // Toggle between static/animated
       Cols, Rows  int      // Terminal dimensions
       WorkDir     string   // For file link resolution
       LinkHandler string   // JS for custom link handling
   }

   func RenderHTML(opts Options) (string, error)
   ```

4. **In swe-swe**, import and use:
   ```go
   import "github.com/choonkeat/record-tui/htmlgen@<commit-sha>"

   html, err := htmlgen.RenderHTML(htmlgen.Options{
       Frames:   frames,
       Title:    name,
       Animated: len(timingContent) > 0,
       // ...
   })
   ```

## What record-tui Does Better

1. **Simpler HTML template** - Less complex CSS, more focused
2. **Post-render dimension trimming** - Removes empty rows at bottom
3. **Clean footer branding** - Minimal, unobtrusive

## What swe-swe Does Better

1. **Animated playback** - Full video-like experience with controls
2. **Clickable file paths** - Opens VS Code with correct folder
3. **Clickable URLs** - Opens links in new tabs
4. **Recorded dimensions** - Preserves original terminal size
5. **Loading UX** - Shows spinner and data size while loading large sessions

## Conclusion

The core HTML generation approach is similar between both projects (xterm.js + base64-encoded frames). The main differences are:
- **Header parsing**: Different formats, swe-swe's is more complex
- **Playback mode**: swe-swe has animated, record-tui is static only
- **Features**: swe-swe has more (links, controls, navigation)

If the goal is to use record-tui's "cleaner" HTML output, the best path is to:
1. Fix the Go version issue in record-tui
2. Extend record-tui to be a proper library with optional features
3. Import it in swe-swe by commit SHA

However, given that swe-swe already has a more feature-rich implementation, it might be simpler to just adopt record-tui's visual styling (CSS, footer) rather than replacing the entire HTML generation.
