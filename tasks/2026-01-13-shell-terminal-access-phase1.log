# Phase 1 Verification Log

## Pre-verification checks
- [x] make test - PASSED (all tests pass)
- [x] make build golden-update - PASSED (changes are as expected: Homepage field, shell config, filtering, runtime resolution, parent param)

## MCP Browser Verification Plan

### Step 4: Navigate to homepage, verify no "Shell" option visible
- Expected: Homepage should show Claude, Gemini, Codex, Goose, Aider, OpenCode (based on installed binaries) but NOT Shell

### Step 5: Create AI session with named worktree
- Expected: Create a session with a name to trigger worktree creation

### Step 6-7: Navigate to shell session with parent param, verify pwd
- Expected: Shell starts in worktree directory (e.g., /workspace/.worktrees/session-name), not /workspace
- This is the CRITICAL test for worktree pwd inheritance

### Step 8: Test shell session without parent param
- Expected: Shell starts in /workspace (default)

---
## Verification Execution

### Step 4: Homepage verification
- PASSED: Homepage shows only "OpenCode" (the installed AI assistant)
- Shell option is NOT visible on the homepage (as expected)


### Step 5: Created AI session 
- Session UUID: df388637-5a7a-4ade-bbff-7b9ef63c6f91
- WorkDir: /workspace (no worktree - worktree creation fails in test container due to /worktrees permission)

### Step 6-7: Shell session with parent parameter
- Navigated to: /session/shell-test-002?assistant=shell&parent=df388637-5a7a-4ade-bbff-7b9ef63c6f91
- Console log shows: `[WS] Connecting to ws://.../ws/shell-test-002?assistant=shell&parent=df3...` 
- Server log shows: `Shell session inheriting workDir from parent df388637-5a7a-4ade-bbff-7b9ef63c6f91:`
- Shell prompt shows: `app@f84849bf8264:/workspace$`
- PASSED: Parent parameter is correctly passed and processed
- NOTE: WorkDir is empty (defaults to /workspace) because parent session has no worktree

### Worktree issue RESOLVED
- Fixed Dockerfile to create `/worktrees` with app user ownership
- Fixed entrypoint.sh to chown bind-mounted /worktrees directory
- Worktrees now work correctly in test container

### Step 5b: Created worktree session for final verification
- Session: "verify-shell-pwd"
- Session UUID: 69ddcddd-5aba-4384-b341-aa2c5af368b1
- WorkDir: /worktrees/verify-shell-pwd
- Server log: "Generated worktree command: /worktrees/verify-shell-pwd/swe-swe/merge-this-worktree"
- PASSED: Worktree created successfully at /worktrees/verify-shell-pwd

### Step 6b-7b: CRITICAL - Shell session inherits worktree pwd
- Navigated to: /session/shell-verify-test?assistant=shell&parent=69ddcddd-5aba-4384-b341-aa2c5af368b1
- Console log shows: `[WS] Connecting to ws://.../ws/shell-verify-test?assistant=shell&parent=69ddcddd...`
- Server log shows: `Shell session inheriting workDir from parent 69ddcddd-5aba-4384-b341-aa2c5af368b1: /worktrees/verify-shell-pwd`
- Server log shows: `Shell session: using /bin/bash -l`
- **Shell prompt shows: `app@9641eb5c4080:/worktrees/verify-shell-pwd$`**
- **PASSED: Shell correctly inherits worktree working directory!**

### Step 8: Shell session without parent parameter
- Navigated to: /session/shell-test-no-parent?assistant=shell
- Shell prompt shows: `app@f84849bf8264:/workspace$`
- PASSED: Shell without parent starts in /workspace (default)

---
## Verification Summary

| Step | Expected | Result |
|------|----------|--------|
| Step 4: Homepage check | No Shell visible | ✓ PASSED |
| Step 5: Create AI session | Session created | ✓ PASSED |
| Step 5b: Create worktree session | Worktree at /worktrees/verify-shell-pwd | ✓ PASSED |
| Step 6: Navigate to shell with parent | Shell connects with parent param | ✓ PASSED |
| Step 7: Verify pwd inheritance (non-worktree) | Shell inherits parent workDir | ✓ PASSED |
| **Step 7b: Verify pwd inheritance (WORKTREE)** | **Shell pwd = /worktrees/verify-shell-pwd** | **✓ PASSED** |
| Step 8: Shell without parent | Starts in /workspace | ✓ PASSED |

**CRITICAL TEST PASSED**: The shell session with parent=worktree-session-uuid correctly inherits the worktree working directory. Shell prompt shows `/worktrees/verify-shell-pwd` proving the pwd inheritance works exactly as required.

