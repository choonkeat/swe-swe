# Clickable File Path Links in Terminal

## Goal

Implement clickable file path hyperlinks in swe-swe's xterm UI, shared between both live terminal sessions and recording playback, using xterm.js's `registerLinkProvider` API.

**Click behavior**: Copy path to clipboard + open VS Code at the correct workspace folder.

---

## Phase 1: Server passes workspace path to frontend ✅

### What will be achieved
Add `workDir` to the existing `status` WebSocket message. Frontend stores it for VS Code URL construction.

### Steps

1. ✅ **Add `workDir` to `BroadcastStatus`** in `main.go` line ~372
2. ✅ **Frontend receives and stores `workDir`** in `terminal-ui.js`
3. ✅ **If `workDir` is empty, default to server cwd** - Server uses os.Getwd() fallback

### Verification

1. ✅ `make test` - tests pass
2. Manual verification deferred to Phase 5

---

## Phase 2: Refactor status bar VS Code link to use shared helper ✅

### What will be achieved
Create a `getVSCodeUrl()` helper function that uses `this.workDir` to construct the correct VS Code URL. Update the status bar link to use this helper.

### Steps

1. ✅ **Create `getBaseUrl()` and `getVSCodeUrl()` methods** in `terminal-ui.js`
2. ✅ **Update `renderServiceLinks()`** to use `this.getVSCodeUrl()`
3. ✅ **Re-render service links when `workDir` changes** - Call `renderServiceLinks()` in status handler

### Verification

1. ✅ `make test` - tests pass
2. Manual verification deferred to Phase 5

---

## Phase 3: Create link provider using shared helper ✅

### What will be achieved
Create `link-provider.js` with `registerFileLinkProvider(terminal, options)` that detects file paths in terminal output, makes them clickable, and on click: copies path to clipboard + opens VS Code.

### Steps

1. ✅ **Create `static/link-provider.js`** with regex-based path detection and xterm.js link provider
2. ✅ **Implement path detection** matching absolute/relative paths with optional line:col suffixes
3. ✅ **Implement click handler** - copies path to clipboard and opens VS Code
4. ✅ **Add script to `index.html`**
5. ✅ **Call `registerFileLinkProvider()` in `terminal-ui.js`** after terminal init

### Verification

1. ✅ `make test` - tests pass
2. Manual verification deferred to Phase 5

---

## Phase 4: Integrate into recording playback ✅

### What will be achieved
Embed `link-provider.js` into the recording playback HTML generated by `render.go`.

### Steps

1. ✅ **Embed `link-provider.js` in `render.go`** using Go's embed
2. ✅ **Inline link-provider.js in generated HTML**
3. ✅ **Call `registerFileLinkProvider()` after xterm init** with WorkDir from recording metadata
4. ✅ **Pass `WorkDir` to playback template** from recording metadata
5. ✅ **Add WorkDir to RecordingMetadata struct** and save when session starts
6. ✅ **Add link-provider.js to hostFiles** in main.go for init command

### Verification

1. ✅ `make test` - tests pass
2. ✅ `make build golden-update` - golden files updated
3. Manual verification deferred to Phase 5

---

## Phase 5: End-to-end verification

### What will be achieved
Comprehensive testing using browser MCP.

### Steps

1. **Boot test container** per `/workspace/.swe-swe/test-container-workflow.md`

2. **Test live session - regular workspace**:
   - Start session, run `echo "/workspace/src/main.go:42"`
   - Verify link appears, click copies + opens VS Code
   - Verify status bar VS Code link is `/vscode/`

3. **Test live session - worktree**:
   - Switch to worktree session
   - Verify VS Code link includes `?folder=/workspace/.swe-swe/worktrees/...`

4. **Test recording playback**:
   - View recording with file paths
   - Verify paths clickable, behavior matches live

5. **Test edge cases**:
   - URLs should NOT become file links
   - Paths with special chars
   - Multiple paths on same line

6. **Shutdown test container**

---

## Files to modify

- `cmd/swe-swe/templates/host/swe-swe-server/main.go` - Add workDir to status message
- `cmd/swe-swe/templates/host/swe-swe-server/static/terminal-ui.js` - Store workDir, add getVSCodeUrl(), call link provider
- `cmd/swe-swe/templates/host/swe-swe-server/static/index.html` - Load link-provider.js
- `cmd/swe-swe/templates/host/swe-swe-server/static/link-provider.js` - NEW FILE
- `cmd/swe-swe/templates/host/swe-swe-server/playback/render.go` - Embed and use link provider

## Related tracking

See `tasks/pending-vscode-file-open-query-param.md` for upstream code-server issues that would enable opening specific files directly.
