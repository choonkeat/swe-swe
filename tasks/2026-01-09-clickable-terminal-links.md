# Clickable File Path Links in Terminal

## Goal

Implement clickable file path hyperlinks in swe-swe's xterm UI, shared between both live terminal sessions and recording playback, using xterm.js's `registerLinkProvider` API.

**Click behavior**: Copy path to clipboard + open VS Code at the correct workspace folder.

---

## Phase 1: Server passes workspace path to frontend ✅

### What will be achieved
Add `workDir` to the existing `status` WebSocket message. Frontend stores it for VS Code URL construction.

### Steps

1. ✅ **Add `workDir` to `BroadcastStatus`** in `main.go` line ~372
2. ✅ **Frontend receives and stores `workDir`** in `terminal-ui.js`
3. ✅ **If `workDir` is empty, default to server cwd** - Server uses os.Getwd() fallback

### Verification

1. ✅ `make test` - tests pass
2. Manual verification deferred to Phase 5

---

## Phase 2: Refactor status bar VS Code link to use shared helper ✅

### What will be achieved
Create a `getVSCodeUrl()` helper function that uses `this.workDir` to construct the correct VS Code URL. Update the status bar link to use this helper.

### Steps

1. ✅ **Create `getBaseUrl()` and `getVSCodeUrl()` methods** in `terminal-ui.js`
2. ✅ **Update `renderServiceLinks()`** to use `this.getVSCodeUrl()`
3. ✅ **Re-render service links when `workDir` changes** - Call `renderServiceLinks()` in status handler

### Verification

1. ✅ `make test` - tests pass
2. Manual verification deferred to Phase 5

---

## Phase 3: Create link provider using shared helper ✅

### What will be achieved
Create `link-provider.js` with `registerFileLinkProvider(terminal, options)` that detects file paths in terminal output, makes them clickable, and on click: copies path to clipboard + opens VS Code.

### Steps

1. ✅ **Create `static/link-provider.js`** with regex-based path detection and xterm.js link provider
2. ✅ **Implement path detection** matching absolute/relative paths with optional line:col suffixes
3. ✅ **Implement click handler** - copies path to clipboard and opens VS Code
4. ✅ **Add script to `index.html`**
5. ✅ **Call `registerFileLinkProvider()` in `terminal-ui.js`** after terminal init

### Verification

1. ✅ `make test` - tests pass
2. Manual verification deferred to Phase 5

---

## Phase 4: Integrate into recording playback ~~✅~~ (superseded)

> **Note**: This phase was completed but later superseded when playback was refactored to use the `record-tui` library (commit `c4900ea0`). The custom `render.go` no longer exists; playback HTML is now generated by `dist/choonkeat/record-tui/internal/html/template.go`.

### What was achieved (historical)
Embedded `link-provider.js` into the recording playback HTML generated by the now-removed `render.go`.

---

## Phase 5: End-to-end verification ✅

### What will be achieved
Comprehensive testing using browser MCP.

### Steps

1. ✅ **Boot test container** per `/workspace/.swe-swe/test-container-workflow.md`

2. ✅ **Test live session - regular workspace**:
   - Started Claude session, asked it to print `/workspace/main.go:42:10`
   - Verified link appears (cursor:pointer on hover)
   - Click opens VS Code with `?folder=%2Fworkspace`
   - Fixed clipboard error: added `if (navigator.clipboard)` check for non-secure contexts (HTTP)

3. ⏭️ **Test live session - worktree**: (skipped - same logic, verified in code)

4. ✅ **Test recording playback**:
   - Viewed recording with file paths
   - Paths clickable, click opens VS Code correctly
   - No console errors (clipboard fix working)

5. ⏭️ **Test edge cases**: (skipped - regex patterns exclude URLs by design)

6. ✅ **Shutdown test container**

---

## Files modified

- `cmd/swe-swe/templates/host/swe-swe-server/main.go` - Add workDir to status message
- `cmd/swe-swe/templates/host/swe-swe-server/static/terminal-ui.js` - Store workDir, add getVSCodeUrl(), call link provider
- `cmd/swe-swe/templates/host/swe-swe-server/static/index.html` - Load link-provider.js
- `cmd/swe-swe/templates/host/swe-swe-server/static/link-provider.js` - NEW FILE
- ~~`cmd/swe-swe/templates/host/swe-swe-server/playback/render.go`~~ - Superseded by record-tui library

## Related tracking

See `tasks/pending-vscode-file-open-query-param.md` for upstream code-server issues that would enable opening specific files directly.
