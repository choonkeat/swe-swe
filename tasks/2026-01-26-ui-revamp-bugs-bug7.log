## Bug 7: Shell Exit Closes Entire Right Panel - Investigation & Fix Log

### 2026-01-26 - Investigation Phase

[Time: Starting investigation]

**What will be done**: Investigate how shell exit is handled in terminal-ui.js and implement fix to switch to Preview tab instead of closing the panel.

**Expected outcome**: After fix, when shell exits in right panel, the UI should automatically switch to the Preview tab instead of closing the entire right panel.

**Investigation findings**:
- Line 2218-2222 in terminal-ui.js listens for 'swe-swe-session-ended' message from iframe
- Current behavior: calls `this.closeIframePane()` which hides the entire right panel
- Fix needed: change to `this.switchPanelTab('preview')` to switch to Preview tab instead

**Fix approach**:
- Modify the message listener at line 2218-2222
- Change `this.closeIframePane()` to `this.switchPanelTab('preview')`
- This will keep the right panel open but show the App Preview instead of the exited shell

### 2026-01-26 23:33 - Fix Implementation

**Fix implemented**: Changed line 2220 from `this.closeIframePane()` to `this.switchPanelTab('preview')`

Build and tests passed.

### 2026-01-26 23:34 - Verification Phase

**What will be done**:
1. Navigate to test container homepage at http://host.docker.internal:9770/
2. Login with password "changeme"
3. Create a new OpenCode session
4. Click "Terminal" tab in right panel to open a shell
5. Type "exit" in the shell to close it
6. Verify that the panel switches to "Preview" tab instead of closing

**Expected outcome**: After typing "exit" in the right-panel shell, the right panel should remain visible and switch to the Preview tab.

